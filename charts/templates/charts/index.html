{% extends "charts/base.html" %}

{% block title %}Yocto QA Tests{% endblock %}

{% block scripts %}
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">
      google.load("visualization", "1.1", {packages:["bar"]});
      google.setOnLoadCallback(drawChart);
      function drawChart() {

        var mydata = new google.visualization.DataTable();

        mydata.addColumn('string', 'Release');
        mydata.addColumn('number', 'Passed');
        mydata.addColumn('number', 'Failed');

        var ids = {};
        {% for release, obj in testruns.items %}
            mydata.addRow(
              ['{{ release }}',
               {{ obj.passed }},
               {{ obj.failed }}
               ]);
            ids[{{ forloop.counter0 }}] = '{{ release }}';
        {% endfor %}


        var options = {
          height: 500,
          chartArea: {width: '90%', height: '80%'},
          focusTarget: 'category',

          legend: 'none',

          colors: ['#8bc34a', '#d32f2f'],

          isStacked: true,

          chart: {
            title: 'Tests run for version {{ version }}',
          },
        };

        var chart = new google.charts.Bar(document.getElementById('columnchart'));

        function selectHandler() {
          var selectedItem = chart.getSelection()[0];
          if (selectedItem) {
            var newlink = {% url 'charts:base_testreport' as link %}"{{ link | escapejs }}" + ids[selectedItem.row];
            window.location.href = newlink;
          }
        }
        google.visualization.events.addListener(chart, 'select', selectHandler);

        chart.draw(mydata, google.charts.Bar.convertOptions(options));
      }

      $(window).resize(function() {
          drawChart();
        });
    </script>

{% endblock scripts %}

{% block body %}
    <div id="page-wrapper">
        <div class="row">
            <div class="col-lg-12">
                <h1 class="page-header">Chart for release {{ version }}</h1>
            </div>
            <!-- /.col-lg-12 -->
        </div>
        <!-- /.row -->
        <div class="row">
            <div class="col-lg-8">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <div class="dropdown">
                            <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true">
                                {% if start %}
                                    Select version
                                {% else %}
                                    {{ version }}
                                {% endif %}
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                                {% for choice in version_form.versions.field.choices %}
                                    {% if forloop.counter0 == 0 %}
                                    {% else %}
                                        <li role="presentation"><a role="menuitem" tabindex="-1" href="{% url 'charts:index_2' choice.0 %}">{{ choice.0 }}</a></li>
                                    {% endif %}
                                {% endfor %}
                            </ul>
                        </div>
                        <br />
                        <div id="columnchart"></div>
                    </div>
                    <!-- /.panel-body -->
                </div>
                <!-- /.panel -->
                
            </div>
            <!-- /.col-lg-8 -->
        </div>
        <!-- /.row -->

    </div>
    <!-- /#page-wrapper -->

{% endblock body %}
